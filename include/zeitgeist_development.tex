\section{Introduction}

As mentioned before Zeitgeist is an event log and not a search engine or 
file tracker. It just logs the various events occouring on the system 
like file opened, file modified, call placed, IM received etc.

\section{Engine}

At the heart zeitgeist consists of an engine which runs as a daemon. It's 
work is to simply receive events, store it in the database, provide the 
events when requested for. The daemon exposes a per-user D-Bus which runs 
as a SessionBus.


\noindent
\linebreak 
The daemon stores all the events and related metadata in an sqlite database 
which is stored in 

\texttt{\$XDG\_DATA\_HOME/zeitgeist/activity.sqlite}

\noindent
where \texttt{\$XDG\_DATA\_HOME} equals to \texttt{\$HOME/.local/share} in 
most of the cases.


\noindent
\linebreak 
If there are more than one user on the system, then every user will have 
their own Zeitgeist SessionBus and thus their own seperate sqlite database. 
This behaviour of SessionBus is useful for keeping activities of different 
users stored under their own directory.

\section{The Basic Unit: Event}

If the engine is the heart, then the role of blood is being taken up by Events. 
Events are packet of information which contain the data about any kind of activity 
occouring on the system.


\noindent
An Event contains:
\begin{itemize}
\item \textbf{id} - Every event has a unique identifier which can be used to identify 
an event from others. It is of type int
\item \textbf{timestamp} - This is the time when the event occoured. The value stored is 
the number of milliseconds since UNIX epoch. UNIX epoch is the moment which is 
00:00:00 UTC on Thursday, January 1st, 1970.
\item \textbf{interpreation} - This defines "what happened" using a formal URI. The 
predefined set of URIs are available and will be covered later.
\item \textbf{manifestation} - This defines “how did this happen” using a formal URI. 
The predefined set of URIs are available and will be covered later.
\item \textbf{actor} - The URI defining the entity responsible for this event. 
In most of the case it is an application. In case of application the 
application:// URI is used. e.g. application://firefox.desktop
\item \textbf{subjects} - This just represents the subject of the event. There can be more 
than one subjects but in majority of the cases, only one is needed
\item \textbf{payload} - An array of bytes which can be used for freeform storage of any 
data associated with the event. The encoding or format of the data is not handled 
by the engine and is left upon the clients.
\end{itemize}


\noindent
A Subject contains:
\begin{itemize}
\item \textbf{uri} - The Universal Resource Identifier associated with the resource involved 
in this event. This URI stored should be such that the event it is representing can 
be reproduced using this. e.g. In case a file is opened, closed, edited then the URI 
will be file URL which can be like \texttt{file:///etc/fstab} or if the webpage was 
accessed, then the URL of the website becomes the URL like \texttt{http://google.com} 
or if the application is launcher, then \texttt{application://firefox.desktop} 
can be the URI if Firefox was launched.
\item \textbf{interpreatio}n - the abstract notion of what the subject is, eg. \"this is a document\" or \"this is an image\". The interpretation is formally represented by a URI.
\item \textbf{manifestation} - the abstract notion of how the subject is stored or available, eg. \"this is file\" or \"this is a webpage\". The manifestation is formally represented by a URI.
\item \textbf{origin} - The URI from where the user accessed the subject from. In case the user 
opened the file \texttt{file:///etc/fstab}, then the origin is \texttt{file:///etc/} and 
in case of \texttt{http://google.com/accounts/list} origin is \texttt{http://google.com/} 
and in case of application launches origin is empty.
\item \textbf{mimetype} - The mimetype of the subject. Examples are \texttt{text/plain}, 
\texttt{text/html}, \texttt{image/png} and \texttt{application/octet-stream}
\item \textbf{text} - A short textual representation of the subject. In case of PDF, the title of 
the PDF can be the text. In case of music track - Title, Genre and artist is the text. In 
case of webpage accessed, the title of webpage can be the text.
\item \textbf{storage} -  represents the id storage device the subject is. For files this would be the UUID of the volume, for subjects requiring a network interface use the 
string “net”. If the subject has been deleted use the string “deleted”. The storage id 
of the subject is used internally in the Zeitgeist engine to keep track of subject 
availability. This way clients can request hits only on subjects that are 
currently available.
\end{itemize}

\section{The D-Bus interface}

Zeitgeist exposes a D-Bus Session bus with the busname as \texttt{org.gnome.zeitgeist.Engine}, 
Object path as \texttt{/org/gnome/zeitgeist/log/activity} and interface 
\texttt{org.gnome.zeitgeist.Log}

\linebreak
The following operations are possible over the interface

\begin{itemize}
\item Inserting events
\item Deleting Events
\item Fetching events by passing the event ids
\item Searching events by passing the template which would be matched against events
\item Exiting the daemon. It is equivalent of calling quit
\end{itemize}

Most of the time you would never need to deal directly with D-Bus since zeitgeist has 
libraries for most of the famous languages which abstract the complexity of D-Bus. We 
have language bindings for C, Vala, Python, C++/Qt and C\#. Each binding abstracts the 
complexity and presents a developer friendly frontend and the programming patterns 
for individual languages.